<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from mbot_gazebo.urdf.xacro         | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<robot name="mbot">
  <!-- 颜色定义 -->
  <material name="orange">
    <color rgba="1.0 0.5 0.0 1.0"/>
  </material>
  <material name="black">
    <color rgba="0.0 0.0 0.0 1.0"/>
  </material>
  <!-- 底盘 -->
  <link name="base_link">
    <visual>
      <geometry>
        <cylinder length="0.05" radius="0.175"/>
      </geometry>
      <material name="orange"/>
    </visual>
    <collision>
      <geometry>
        <cylinder length="0.05" radius="0.175"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="1.0"/>
      <inertia ixx="0.02" ixy="0.0" ixz="0.0" iyy="0.02" iyz="0.0" izz="0.01"/>
    </inertial>
  </link>
  <!-- 左轮 -->
  <link name="left_wheel_link">
    <visual>
      <geometry>
        <cylinder length="0.02" radius="0.05"/>
      </geometry>
      <material name="black"/>
      <origin rpy="1.5707963267948966 0 0" xyz="0 0 0"/>
    </visual>
    <collision>
      <geometry>
        <cylinder length="0.02" radius="0.05"/>
      </geometry>
      <origin rpy="1.5707963267948966 0 0" xyz="0 0 0"/>
    </collision>
    <inertial>
      <mass value="0.1"/>
      <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
    </inertial>
  </link>
  <!-- 右轮 -->
  <link name="right_wheel_link">
    <visual>
      <geometry>
        <cylinder length="0.02" radius="0.05"/>
      </geometry>
      <material name="black"/>
      <origin rpy="1.5707963267948966 0 0" xyz="0 0 0"/>
    </visual>
    <collision>
      <geometry>
        <cylinder length="0.02" radius="0.05"/>
      </geometry>
      <origin rpy="1.5707963267948966 0 0" xyz="0 0 0"/>
    </collision>
    <inertial>
      <mass value="0.1"/>
      <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
    </inertial>
  </link>
  <!-- 被动轮（万向轮） -->
  <link name="caster_wheel_link">
    <visual>
      <geometry>
        <sphere radius="0.025"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <geometry>
        <sphere radius="0.025"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.05"/>
      <inertia ixx="0.0001" ixy="0.0" ixz="0.0" iyy="0.0001" iyz="0.0" izz="0.0001"/>
    </inertial>
  </link>
  <!-- 激光雷达连杆 -->
  <link name="laser_link">
    <!-- 视觉模型：模拟雷达外观（圆柱形） -->
    <visual>
      <geometry>
        <cylinder length="0.02" radius="0.05"/>
        <!-- 雷达半径0.05m，高度0.1m -->
      </geometry>
      <material name="gray">
        <color rgba="0.5 0.5 0.5 1.0"/>
        <!-- 灰色雷达外壳 -->
      </material>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <!-- 雷达自身坐标系原点 -->
    </visual>
    <!-- 碰撞模型：与视觉模型一致，避免碰撞 -->
    <collision>
      <geometry>
        <cylinder length="0.05" radius="0.05"/>
      </geometry>
      <origin rpy="0 0 0" xyz="0 0 0"/>
    </collision>
    <!-- 惯性参数：雷达质量轻，惯性小 -->
    <inertial>
      <mass value="0.2"/>
      <!-- 雷达质量0.2kg -->
      <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
      <!-- 简化的转动惯量 -->
    </inertial>
  </link>
  <!-- IMU连杆 -->
  <link name="imu_link">
    <visual>
      <geometry>
        <box size="0.01 0.01 0.01"/>
        <!-- 尺寸：0.05m x 0.05m x 0.02m -->
      </geometry>
      <material name="silver">
        <color rgba="0.75 0.75 0.75 1.0"/>
        <!-- 银色外观 -->
      </material>
      <origin rpy="0 0 0" xyz="0 0 0"/>
    </visual>
    <collision>
      <geometry>
        <box size="0.01 0.01 0.01"/>
      </geometry>
      <origin rpy="0 0 0" xyz="0 0 0"/>
    </collision>
    <inertial>
      <mass value="0.05"/>
      <!-- 质量50克 -->
      <inertia ixx="0.0001" ixy="0.0" ixz="0.0" iyy="0.0001" iyz="0.0" izz="0.0001"/>
      <!-- 简化的惯性矩阵 -->
    </inertial>
  </link>
  <!-- 左轮关节 -->
  <joint name="left_wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="left_wheel_link"/>
    <origin rpy="0 0 0" xyz="-0.05 0.125 -0.025"/>
    <axis xyz="0 1 0"/>
  </joint>
  <!-- 右轮关节 -->
  <joint name="right_wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="right_wheel_link"/>
    <origin rpy="0 0 0" xyz="-0.05  -0.125 -0.025"/>
    <axis xyz="0 1 0"/>
  </joint>
  <!-- 被动轮关节 -->
  <joint name="caster_joint" type="continuous">
    <parent link="base_link"/>
    <child link="caster_wheel_link"/>
    <origin rpy="0 0 0" xyz="0.15 0 -0.05"/>
    <axis xyz="0 0 1"/>
  </joint>
  <!-- 雷达关节：固定在底盘顶部 -->
  <joint name="laser_joint" type="fixed">
    <parent link="base_link"/>
    <!-- 父连杆：机身底盘 -->
    <child link="laser_link"/>
    <!-- 子连杆：雷达 -->
    <!-- 安装位置：底盘中心正上方，距离底盘顶部0.1m（避免遮挡） -->
    <origin rpy="0 0 0" xyz="0 0 0.035"/>
    <!-- 说明：
      - x=0, y=0：位于底盘中心
      - z=${base_height/2 + 0.1}：底盘自身高度的一半（base_height/2）加上0.1m的抬高，确保雷达远离机身
    -->
  </joint>
  <!-- IMU关节：固定在底盘中心上方 -->
  <joint name="imu_joint" type="fixed">
    <parent link="base_link"/>
    <child link="imu_link"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <!-- 说明：
      - x=0, y=0：位于底盘中心
      - z=${base_height/2 + 0.01}：在底盘顶部上方0.01m处
    -->
  </joint>
  <!-- 里程计框架 -->
  <link name="odom"/>
  <joint name="odom_joint" type="fixed">
    <parent link="odom"/>
    <child link="base_link"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
  </joint>
  <!-- <xacro:mbot_base /> -->
  <!-- Gazebo插件配置 -->
  <gazebo>
    <plugin filename="libgazebo_ros_diff_drive.so" name="differential_drive">
      <ros>
        <namespace>/mbot</namespace>
        <remapping>cmd_vel:=cmd_vel</remapping>
        <remapping>odom:=odom</remapping>
      </ros>
      <wheel_separation>0.25</wheel_separation>
      <wheel_diameter>0.1</wheel_diameter>
      <max_wheel_speed>2.0</max_wheel_speed>
      <torque>10.0</torque>
      <left_joint>left_wheel_joint</left_joint>
      <right_joint>right_wheel_joint</right_joint>
      <publish_odom>true</publish_odom>
      <publish_odom_tf>true</publish_odom_tf>
      <publish_wheel_tf>true</publish_wheel_tf>
    </plugin>
  </gazebo>
  <gazebo>
    <plugin filename="libgazebo_ros_p3d.so" name="ground_truth_plugin">
      <alwaysOn>true</alwaysOn>
      <updateRate>50.0</updateRate>
      <!-- 发布频率 -->
      <bodyName>base_link</bodyName>
      <!-- 需要获取位姿的link名称 -->
      <topicName>mbot/gazebo_pose</topicName>
      <!-- 发布的话题名 -->
      <frameName>world</frameName>
      <!-- 参考坐标系 -->
      <gaussianNoise>0.0</gaussianNoise>
      <!-- 可添加高斯噪声 -->
      <xyzOffsets>0 0 0</xyzOffsets>
      <!-- 位置偏移 -->
      <rpyOffsets>0 0 0</rpyOffsets>
      <!-- 姿态偏移 -->
    </plugin>
  </gazebo>
  <!-- 在URDF末尾添加Gazebo雷达插件 -->
  <gazebo reference="laser_link">
    <!-- 关联雷达连杆 -->
    <sensor name="laser_sensor" type="ray">
      <pose>0 0 0 0 0 0</pose>
      <!-- 雷达自身姿态（无偏移） -->
      <visualize>false</visualize>
      <!-- 在Gazebo中可视化雷达射线 -->
      <!-- 雷达参数 -->
      <update_rate>10</update_rate>
      <!-- 刷新率10Hz -->
      <ray>
        <scan>
          <horizontal>
            <samples>360</samples>
            <!-- 水平方向360个点 -->
            <resolution>1.0</resolution>
            <!-- 角度分辨率1度 -->
            <min_angle>0</min_angle>
            <!-- 起始角度0度 -->
            <max_angle>6.28319</max_angle>
            <!-- 终止角度2π（360度） -->
          </horizontal>
        </scan>
        <range>
          <min>0.1</min>
          <!-- 最小探测距离0.1m -->
          <max>10.0</max>
          <!-- 最大探测距离10m -->
          <resolution>0.01</resolution>
          <!-- 距离分辨率0.01m -->
        </range>
      </ray>
      <!-- ROS插件：将雷达数据发布为LaserScan消息 -->
      <plugin filename="libgazebo_ros_ray_sensor.so" name="laser_plugin">
        <ros>
          <namespace>/mbot</namespace>
          <!-- 命名空间 -->
          <remapping>scan:=laser/scan</remapping>
          <!-- 发布话题：/mbot/laser/scan -->
        </ros>
        <output_type>sensor_msgs/LaserScan</output_type>
        <!-- 消息类型 -->
      </plugin>
    </sensor>
  </gazebo>
  <!-- IMU传感器插件 -->
  <gazebo reference="imu_link">
    <sensor name="imu_sensor" type="imu">
      <always_on>true</always_on>
      <update_rate>100</update_rate>
      <!-- 更新频率100Hz -->
      <visualize>false</visualize>
      <!-- 不显示可视化射线 -->
      <!-- IMU噪声参数（可根据实际传感器调整） -->
      <linear_acceleration>
        <noise type="gaussian">
          <mean>0.0</mean>
          <stddev>0.01</stddev>
          <!-- 加速度噪声标准差 -->
          <bias_mean>0.0</bias_mean>
          <bias_stddev>0.001</bias_stddev>
        </noise>
      </linear_acceleration>
      <angular_velocity>
        <noise type="gaussian">
          <mean>0.0</mean>
          <stddev>0.005</stddev>
          <!-- 角速度噪声标准差 -->
          <bias_mean>0.0</bias_mean>
          <bias_stddev>0.0001</bias_stddev>
        </noise>
      </angular_velocity>
      <!-- ROS插件：发布IMU消息 -->
      <plugin filename="libgazebo_ros_imu_sensor.so" name="imu_plugin">
        <ros>
          <namespace>/mbot</namespace>
          <!-- 命名空间 -->
          <remapping>imu/data_raw:=imu/data_raw</remapping>
          <!-- 原始IMU数据 -->
          <remapping>imu/data:=imu/data</remapping>
          <!-- 处理后的IMU数据 -->
          <remapping>imu/temperature:=imu/temperature</remapping>
          <!-- 温度数据 -->
        </ros>
        <!-- 插件参数 -->
        <frame_name>imu_link</frame_name>
        <!-- 坐标系名称 -->
        <topic>imu/data</topic>
        <!-- 主话题名 -->
        <queue_size>10</queue_size>
        <gaussian_noise>0.0</gaussian_noise>
        <!-- 全局噪声系数 -->
        <update_rate>100.0</update_rate>
        <!-- 发布频率 -->
      </plugin>
    </sensor>
  </gazebo>
</robot>
